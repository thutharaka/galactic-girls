<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Star Quest Tasks</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Orbitron:wght@500&display=swap" rel="stylesheet">

<link rel="stylesheet" href="styles1.css">
</head>
<body>

<nav class="nav-buttons">
    <a href="index.html" class="nav-button">Home</a>
    <a href="tasks.html" class="nav-button active">To-Do</a>
    <a href="starmap.html" class="nav-button">Star Map</a>
    <a href="teampage.html" class="nav-button">About Us</a>
</nav>

<div class="container">

<!-- MAIN TASKS -->
<div class="card">
    <h1>STAR QUEST</h1>
    <form class="input-form" id="todoForm">
        <input type="text" id="todoInput" placeholder="Enter mission objective..." autocomplete="off">
        <button class="add-btn">LAUNCH</button>
    </form>

    <div class="stats">
        <span id="activeCount"></span>
        <span id="completedCount"></span>
    </div>

    <div id="emptyState" class="empty-state">No missions assigned ðŸš€</div>
    <div id="todoList" class="todo-list"></div>
</div>

<!-- CATEGORY TASKS -->
<div class="category-card">

    <!-- Colonizing Space -->
    <div class="category-title">Colonizing Space</div>
    <div class="category-list">
        <div class="todo-item">
            <input type="checkbox" class="category-checkbox" data-star="star-cat-1">
            Research & Development
            <span class="star" id="star-cat-1"></span>
        </div>
        <div class="todo-item">
            <input type="checkbox" class="category-checkbox" data-star="star-cat-2">
            Mission Planning & Logistics
            <span class="star" id="star-cat-2"></span>
        </div>
        <div class="todo-item">
            <input type="checkbox" class="category-checkbox" data-star="star-cat-3">
            Transportation Systems Development
            <span class="star" id="star-cat-3"></span>
        </div>
    </div>

    <!-- Immersive Worlds -->
    <div class="category-title">Immersive Worlds</div>
    <div class="category-list">
        <div class="todo-item">
            <input type="checkbox" class="category-checkbox" data-star="star-cat-4">
            3D Modeling and Asset Creation
            <span class="star" id="star-cat-4"></span>
        </div>
        <div class="todo-item">
            <input type="checkbox" class="category-checkbox" data-star="star-cat-5">
            Audio and Sound Design
            <span class="star" id="star-cat-5"></span>
        </div>
        <div class="todo-item">
            <input type="checkbox" class="category-checkbox" data-star="star-cat-6">
            Programming Logic and Interactivity
            <span class="star" id="star-cat-6"></span>
        </div>
    </div>

</div>

</div>

<!-- Floating stars in background -->
<div id="starContainer"></div>

<script>
// ðŸ”¹ RESET MAIN TASKS ON BROWSER REOPEN
if (!window.name.includes('starquest_active')) {
    sessionStorage.clear();
    window.name = 'starquest_active';
}

// ===== MAIN USER TASKS =====
let todos = JSON.parse(sessionStorage.getItem('userTodos')) || [];
const todoForm = document.getElementById('todoForm');
const todoInput = document.getElementById('todoInput');
const todoList = document.getElementById('todoList');
const emptyState = document.getElementById('emptyState');
const activeCount = document.getElementById('activeCount');
const completedCount = document.getElementById('completedCount');

todoForm.addEventListener('submit', e => {
    e.preventDefault();
    const text = todoInput.value.trim();
    if (!text) return;

    todos.unshift({ id: Date.now().toString(), text, completed: false });
    todoInput.value = '';
    saveAndRender();
});

function toggleTodo(id) {
    todos = todos.map(t => t.id === id ? { ...t, completed: !t.completed } : t);
    saveAndRender();
}

function deleteTodo(id) {
    todos = todos.filter(t => t.id !== id);
    saveAndRender();
}

function render() {
    todoList.innerHTML = todos.map(todo => `
        <div class="todo-item">
            <input type="checkbox" ${todo.completed ? 'checked' : ''}
                onchange="toggleTodo('${todo.id}')">
            <span class="todo-text ${todo.completed ? 'completed' : ''}"
                onclick="toggleTodo('${todo.id}')">
                ${escapeHtml(todo.text)}
            </span>
            <button class="delete-btn" onclick="deleteTodo('${todo.id}')">âœ–</button>
        </div>
    `).join('');

    const active = todos.filter(t => !t.completed).length;
    const completed = todos.filter(t => t.completed).length;

    activeCount.textContent = `${active} active mission${active !== 1 ? 's' : ''}`;
    completedCount.textContent = completed ? `${completed} completed` : '';
    emptyState.style.display = todos.length ? 'none' : 'block';
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ===== CATEGORY TASKS & STAR GLOW =====
let categoryState = JSON.parse(sessionStorage.getItem('categoryState')) || {};
const categoryCheckboxes = document.querySelectorAll('.category-checkbox');

// Floating stars background
const starContainer = document.getElementById('starContainer');
const NUM_STARS = 50;
const floatingStars = [];
for (let i = 0; i < NUM_STARS; i++) {
    const star = document.createElement('div');
    star.classList.add('star');
    star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
    star.style.top = Math.random() * 100 + '%';
    star.style.left = Math.random() * 100 + '%';
    star.style.animation = `twinkle ${Math.random() * 3 + 2}s infinite`;
    starContainer.appendChild(star);
    floatingStars.push(star);
}

// Update floating stars size/glow based on completed category tasks
function updateFloatingStarGlow() {
   const completedCount = Object.values(categoryState).filter(Boolean).length;
   // limit how strong the glow can get
   const effect = Math.min(completedCount, 3); // clamp to 0..3


   floatingStars.forEach(star => {
       const baseSize = 1 + Math.random() * 2;
       const size = baseSize + effect * 3; // modest growth
       star.style.width = star.style.height = size + 'px';


       // capped blur so glow never covers the page
       const blur = Math.min(20 + effect * 20, 80);
       star.style.boxShadow = `0 0 ${blur}px rgba(245,213,224,0.35)`;
       star.style.opacity = 0.9;
   });
}

// ===== SAVE AND SYNC COMPLETED TASKS TO LOCALSTORAGE =====
function saveAndRender() {
    sessionStorage.setItem('userTodos', JSON.stringify(todos));

    const completedMain = todos.filter(t => t.completed).map(t => t.id);
    const completedCategory = Object.keys(categoryState).filter(starId => categoryState[starId]);
    const allCompleted = [...completedMain, ...completedCategory];

    localStorage.setItem('completedTaskIds', JSON.stringify(allCompleted));

    render();
}

// CATEGORY CHECKBOX EVENTS
categoryCheckboxes.forEach(cb => {
    const starId = cb.dataset.star;
    const starEl = document.getElementById(starId);

    if (categoryState[starId]) {
        cb.checked = true;
        starEl.classList.add('glow');
    }

    cb.addEventListener('change', () => {
        categoryState[starId] = cb.checked;
        starEl.classList.toggle('glow', cb.checked);

        sessionStorage.setItem('categoryState', JSON.stringify(categoryState));

        saveAndRender();
        updateFloatingStarGlow();
    });
});

// Initial floating stars update
updateFloatingStarGlow();

// expose functions globally
window.toggleTodo = toggleTodo;
window.deleteTodo = deleteTodo;

render();
</script>
</body>
</html>
